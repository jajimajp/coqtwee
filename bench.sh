#!/bin/bash

TIMEOUT=20

# ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‡ºåŠ›
echo "# Examples"
echo ""
echo "Examples in this directory are auto-generated by converting examples in TPTP."
echo ""
echo "Each example is tested with a timeout of $TIMEOUT seconds."
echo "- ğŸŸ¢ OK: Compilation completed successfully."
echo "- ğŸ”´ FAIL: Runtime error."
echo "- ğŸŸ¡ TIMEOUT: timeout ($TIMEOUT s)."
echo ""
echo "## Results"
echo ""
echo "| File | LPO.v | Hammer.v | SMT.v |"
echo "|---|---|---|---|"

# ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
process_file() {
    local file="$1"
    local result
    # çµæœã‚’å‡ºåŠ›
    # Check if the result directory exists, if not, create it
    if [ ! -d "../result" ]; then
        mkdir -p ../result
    fi

    # Check if the directory for the problem name exists in ./result, if not, create it
    local problem_dir="../result/$(basename "$dir")"
    if [ ! -d "$problem_dir" ]; then
        mkdir -p "$problem_dir"
    fi
    local output_file="$(basename "$file" .v).out"
    if timeout $TIMEOUT coqc "$file" > "$problem_dir/$output_file" 2>&1; then
        result="ğŸŸ¢ OK"
    else
        if [ $? -eq 124 ]; then
            result="ğŸŸ¡ TIMEOUT"
        else
            result="ğŸ”´ FAIL"
        fi
    fi

    echo "$result [out]($problem_dir/$output_file)"
}

# ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¤œç´¢ã—ã¦å‡¦ç†
find . -type d | while read -r dir; do
    compllpo_file="$dir/LPO.v"
    ham_file="$dir/Hammer.v"
    smt_file="$dir/SMT.v"
    twee_file="$dir/Twee.v"

    if [ -f "$ham_file" ] || [ -f "$compllpo_file" ] || [ -f "$smt_file" ]; then
        echo -n "| [$dir]($dir) |"

        # if [ -f "$compllpo_file" ]; then
        #     echo -n " $(process_file "$compllpo_file") |"
        # else
        #     echo -n " N/A |"
        # fi

        # if [ -f "$ham_file" ]; then
        #     echo -n " $(process_file "$ham_file") |"
        # else
        #     echo -n " N/A |"
        # fi

        # if [ -f "$smt_file" ]; then
        #     echo -n " $(process_file "$smt_file") |"
        # else
        #     echo -n " N/A |"
        # fi
        echo -n " N/A | N/A | N/A |"

        if [ -f "$twee_file" ]; then
            echo -n " $(process_file "$twee_file") |"
        else
            echo -n " N/A |"
        fi

        echo ""
    fi
done
